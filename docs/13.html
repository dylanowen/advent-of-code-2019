<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Advent Of Code 2019</title>
    <style type="text/css"><!--
    .hidden {
        visibility: hidden;
    }

    --></style>
    <script src="js/utils.js"></script>
</head>
<body>
<canvas id="screen"></canvas>
<script>
    LibReady('advent_of_code_2019')
        .then((lib) => {
            const canvas = document.getElementById('screen');



            let game = null;
            let state = lib.ExecutionState.Running;

            function startGame() {
                if (game != null) {
                    game.free();
                }

                game = new lib.ThirteenGame(canvas);
                game.step(1);
                game.render_game();
            }

            startGame();

            window.addEventListener("keydown", event => {
                if (event.isComposing || event.keyCode === 229) {
                    return;
                }
                let input = 0;
                if (event.key === 'a') {
                    input = -1;
                }
                else if (event.key === 'd') {
                    input = 1;
                }

                let state = game.step(input);
                game.render_game();

                if (state === lib.ExecutionState.Halted) {
                    startGame();
                }
                // do something
            });



            // canvas.width = game.width() * pixelSize;
            // canvas.height = game.height() * pixelSize;
            //
            // const ctx = canvas.getContext('2d');
            //
            // // pixels are stored in RGBA
            // imgByteSize = canvas.width * canvas.height * 4;
            // imgPointer = lib.alloc_vec(imgByteSize);
            // function step() {
            //     game.step(0);
            //     game.render_game();
            // }
            //
            // step();

            //setInterval(step, 1000);

        })
        //.then(archizoom => archizoom[0].free())
        .catch((e) => console.error(e));


</script>

</body>
</html>